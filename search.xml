<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Maintain-Agent-Pool</title>
      <link href="/2020/04/07/maintainin-agent-pool/"/>
      <url>/2020/04/07/maintainin-agent-pool/</url>
      
        <content type="html"><![CDATA[<h1 id="Python3维护免费代理池"><a href="#Python3维护免费代理池" class="headerlink" title="Python3维护免费代理池"></a>Python3维护免费代理池</h1><h2 id="一、项目背景"><a href="#一、项目背景" class="headerlink" title="一、项目背景"></a>一、项目背景</h2><p>​        最近在学习Python爬虫，于是想要在网上找一些免费的代理练练手，于是有了这个项目。</p><h2 id="二、项目结构"><a href="#二、项目结构" class="headerlink" title="二、项目结构"></a>二、项目结构</h2><h3 id="1、爬取下面四个站点"><a href="#1、爬取下面四个站点" class="headerlink" title="1、爬取下面四个站点"></a>1、爬取下面四个站点</h3><ul><li>“<a href="https://www.kuaidaili.com/free/inha/&quot;" target="_blank" rel="noopener">https://www.kuaidaili.com/free/inha/"</a></li><li>“<a href="https://www.xicidaili.com/nn/&quot;" target="_blank" rel="noopener">https://www.xicidaili.com/nn/"</a></li><li>“<a href="http://www.66ip.cn/&quot;" target="_blank" rel="noopener">http://www.66ip.cn/"</a></li><li>“<a href="http://www.89ip.cn/index_?.html&quot;" target="_blank" rel="noopener">http://www.89ip.cn/index_?.html"</a></li></ul><h3 id="2、使用百度对爬取到的代理进行检测"><a href="#2、使用百度对爬取到的代理进行检测" class="headerlink" title="2、使用百度对爬取到的代理进行检测"></a>2、使用百度对爬取到的代理进行检测</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">https://www.baidu.com</a></li></ul><h3 id="3、将检测出可用的代理保存到-Proxie-txt-中"><a href="#3、将检测出可用的代理保存到-Proxie-txt-中" class="headerlink" title="3、将检测出可用的代理保存到 Proxie.txt 中"></a>3、将检测出可用的代理保存到 <code>Proxie.txt</code> 中</h3><h2 id="三、项目代码"><a href="#三、项目代码" class="headerlink" title="三、项目代码"></a>三、项目代码</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python3</span><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*- </span><span class="token comment" spellcheck="true"># --author：valecalida--</span><span class="token comment" spellcheck="true"># Edit time: 2020/4/5 19:04</span><span class="token keyword">from</span> requests <span class="token keyword">import</span> RequestException<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> urllib3<span class="token keyword">import</span> requests<span class="token keyword">import</span> random<span class="token keyword">import</span> time<span class="token keyword">import</span> re<span class="token keyword">import</span> sys<span class="token keyword">import</span> osurllib3<span class="token punctuation">.</span>disable_warnings<span class="token punctuation">(</span>urllib3<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InsecureRequestWarning<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_user_agent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    user_agent <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1090.0 Safari/536.6"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/19.77.34.5 Safari/537.1"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.9 Safari/536.5"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/22.0.1207.1 Safari/537.1"</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1092.0 Safari/536.6"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.0) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.36 Safari/536.5"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.1 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1063.0 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1062.0 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.2) AppleWebKit/536.3 (KHTML, like Gecko) Chrome/19.0.1061.0 Safari/536.3"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24"</span><span class="token punctuation">,</span>        <span class="token string">"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/535.24 (KHTML, like Gecko) Chrome/19.0.1055.1 Safari/535.24"</span>    <span class="token punctuation">]</span>    header <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>user_agent<span class="token punctuation">)</span>    <span class="token keyword">return</span> header<span class="token keyword">class</span> <span class="token class-name">MaintainProxyPool</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>kuai_proxy <span class="token operator">=</span> <span class="token string">"https://www.kuaidaili.com/free/inha/"</span>        self<span class="token punctuation">.</span>xici_proxy <span class="token operator">=</span> <span class="token string">"https://www.xicidaili.com/nn/"</span>        self<span class="token punctuation">.</span>ip66_proxy <span class="token operator">=</span> <span class="token string">"http://www.66ip.cn/"</span>        self<span class="token punctuation">.</span>ip89_proxy <span class="token operator">=</span> <span class="token string">"http://www.89ip.cn/index_"</span>        self<span class="token punctuation">.</span>check_proxy <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span>        self<span class="token punctuation">.</span>header <span class="token operator">=</span> get_user_agent<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>total_website <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>merge_infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>kuai_infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>xici_infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>ip66_infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>ip89_infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>active_infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>alive_site <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">get_kuai_proxy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t[..] 开始爬取kuai代理的代理"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[.] 开始爬取第%d页的代理信息"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 154</span>            url <span class="token operator">=</span> self<span class="token punctuation">.</span>kuai_proxy <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span>            header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>header<span class="token punctuation">}</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>            <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>                <span class="token keyword">pass</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>                html <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> index <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>kuai_infos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;td data.*?>(.*)&lt;/td>"</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>html<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[+] 爬取完成！本次爬取的代理信息共 %d 条"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>kuai_infos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_xici_proxy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t[..] 开始爬取xici的代理"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[.] 开始爬取第%d页的代理信息"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>            url <span class="token operator">=</span> self<span class="token punctuation">.</span>xici_proxy <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span>            header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>header<span class="token punctuation">}</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>            <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>                <span class="token keyword">pass</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>                html <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> index <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>xici_infos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;td>(.*)&lt;/td>"</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>html<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[+] 爬取完成！本次爬取的代理信息共 %d 条"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>xici_infos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_ip66_proxy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t[..] 开始爬取ip66的代理"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            url <span class="token operator">=</span> self<span class="token punctuation">.</span>ip66_proxy <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".html"</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[.] 开始爬取第%d页的代理信息"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>            header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>header<span class="token punctuation">}</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>            <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>                <span class="token keyword">pass</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                res<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'gbk'</span>                soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>                html <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                <span class="token keyword">for</span> index <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>ip66_infos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;td>(.*?)&lt;/td>"</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>html<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[+] 爬取完成！本次爬取的代理信息共 %d 条"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip66_infos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_ip89_proxy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t[..] 开始爬取ip89的代理"</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            url <span class="token operator">=</span> self<span class="token punctuation">.</span>ip89_proxy <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".html"</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[.] 开始爬取第%d页的代理信息"</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>            header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>header<span class="token punctuation">}</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>            <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>                <span class="token keyword">pass</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>                html <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> index <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>ip89_infos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;td>\s*(.*)\t\t&lt;/td>"</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>html<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[+] 爬取完成！本次爬取的代理信息共 %d 条"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip89_infos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">detect_open</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>total_website<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip89_proxy <span class="token operator">+</span> <span class="token string">"1.html"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>total_website<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip66_proxy<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>total_website<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>xici_proxy<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>total_website<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>kuai_proxy<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[..] 开始检测预定义的 %d 个站点是否可用"</span> <span class="token operator">%</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>total_website<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> website <span class="token keyword">in</span> self<span class="token punctuation">.</span>total_website<span class="token punctuation">:</span>            header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>header<span class="token punctuation">}</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>website<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>            <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>                <span class="token keyword">pass</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>alive_site<span class="token punctuation">.</span>append<span class="token punctuation">(</span>website<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">merge_proxy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>merge_infos <span class="token operator">=</span> self<span class="token punctuation">.</span>ip66_infos <span class="token operator">+</span> self<span class="token punctuation">.</span>kuai_infos <span class="token operator">+</span> self<span class="token punctuation">.</span>xici_infos <span class="token operator">+</span> self<span class="token punctuation">.</span>ip89_infos        infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> merge_info <span class="token keyword">in</span> self<span class="token punctuation">.</span>merge_infos<span class="token punctuation">:</span>            infos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>merge_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> merge_info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>merge_infos <span class="token operator">=</span> list<span class="token punctuation">(</span>set<span class="token punctuation">(</span>infos<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">check_active</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[..] 开始对爬取到的代理进行检测..."</span><span class="token punctuation">)</span>        header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>header<span class="token punctuation">}</span>        <span class="token keyword">for</span> ip_list <span class="token keyword">in</span> self<span class="token punctuation">.</span>merge_infos<span class="token punctuation">:</span>            os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"echo 正在测试：%s的可用性 >> test.log"</span> <span class="token operator">%</span> ip_list<span class="token punctuation">)</span>            proxies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"https"</span><span class="token punctuation">:</span> <span class="token string">"https://"</span> <span class="token operator">+</span> ip_list<span class="token punctuation">,</span> <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://"</span> <span class="token operator">+</span> ip_list<span class="token punctuation">}</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>check_proxy<span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>                <span class="token keyword">pass</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>active_infos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ip_list<span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\t\t[+] %s是可用的"</span> <span class="token operator">%</span> ip_list<span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>    <span class="token keyword">def</span> <span class="token function">save_active</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[..] 正在写入本地文件\"%s写入可用代理信息\""</span> <span class="token operator">%</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/proxy.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'proxy.txt'</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            <span class="token keyword">for</span> info <span class="token keyword">in</span> self<span class="token punctuation">.</span>active_infos<span class="token punctuation">:</span>                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>info <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] 写入完成"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">run_proxy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>detect_open<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]本次检测中可用的代理站点地址数共 %d 个，不可用地址数共 %d 个"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>alive_site<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>total_website<span class="token punctuation">)</span> <span class="token operator">-</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>alive_site<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>alive_site<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[-] 所有的站点均不可用，将直接退出程序!"</span><span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> website <span class="token keyword">in</span> self<span class="token punctuation">.</span>alive_site<span class="token punctuation">:</span>                <span class="token keyword">if</span> website <span class="token operator">==</span> self<span class="token punctuation">.</span>ip89_proxy <span class="token operator">+</span> <span class="token string">"1.html"</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>get_ip89_proxy<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">elif</span> website <span class="token operator">==</span> self<span class="token punctuation">.</span>ip66_proxy<span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>get_ip66_proxy<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">elif</span> website <span class="token operator">==</span> self<span class="token punctuation">.</span>kuai_proxy<span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>get_kuai_proxy<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">elif</span> website <span class="token operator">==</span> self<span class="token punctuation">.</span>xici_proxy<span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>get_xici_proxy<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>merge_proxy<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[..] 经过对爬取到的代理信息组合、去重后还剩下：%d 条代理信息"</span> <span class="token operator">%</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>merge_infos<span class="token punctuation">)</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>check_active<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>save_active<span class="token punctuation">(</span><span class="token punctuation">)</span>MaintainProxyPool<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run_proxy<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Tips：如果有侵权的地方，请第一时间联系我，我会马上处理"><a href="#Tips：如果有侵权的地方，请第一时间联系我，我会马上处理" class="headerlink" title="Tips：如果有侵权的地方，请第一时间联系我，我会马上处理"></a>Tips：如果有侵权的地方，请第一时间联系我，我会马上处理</h3><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Python、Spider </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Spider </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
